( BLACKJACK a small program converted from FigForth 79.             What it does is obvious, so I won't bother to explain           further here.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            )  ( blackjack load screen )                                       REQUIRES facility                                               2 9 THRU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        : BLACKJACK ;             ( first, my constants and variables )  VARIABLE CARDS VARIABLE HAND        ( comp hand, player hand )  VARIABLE RND  VARIABLE CARD     ( random generator/last card )  VARIABLE BET  VARIABLE TOTAL              ( bet & win/losses )  VARIABLE HACE VARIABLE CACE       ( human/computer ace flags )  VARIABLE TESTV                       ( an exit the loop flag )  314 CONSTANT SD                  ( constant used in rnd gen. )                                                                 : HELLO ." Welcome to Forth Blackjack. " CR ;                   : 1$ CR ." Ace converted to 11." CR ;                           : 2$ CR ." Ace converted to 1." CR ;                            : DRAW CR ." We have both busted!" CR ;                                                              ( the strings obviously! )                                                                                                                                                                                                 ( BLACKJACK )                      ( win, lose, draw and deal )                                                                 : LOSE ." Hand lost." CR BET @ NEGATE TOTAL +! ;                                                       ( lose - take bet amt. )                                                                 : WIN ." Hand won." CR BET @ DUP TOTAL +! 2 / TOTAL +! ;                                               ( win - credit balance )                                                                 : QUSH ." Push! " CR BET @ NEGATE TOTAL +! ;                                                   ( push - we take the bet again )                                                                 : DEAL ( -- n ) RND @ SD + 12287 AND DUP RND ! @ ABS 12 MOD 1+     DUP 10 > IF DROP 10 THEN DUP CARD ! ;                                                 ( deal - randomly generate next card )                                                                                                                                 ( BLACKJACK )              ( shift aces to greatest advantage ) : ACE1 HACE @ 0 > IF -1 HACE +! -10 HAND +! 2$ THEN ;                                                  ( change ace back to 1 ) : ACE2 CARD @ 1 = IF 1 HACE +! 10 HAND +! 1$ THEN ;                                            ( change an ace to 11 if dealt ) : ACEH1 HAND @ 21 > IF ACE1 ELSE ACE2 THEN 0 CARD ! ;                                 ( change ace back to 1 if a bust occurs ) : ACEH ACEH1 ACEH1 ;                                                  ( do above twice for multiple aces for the human player )                                                                 : ACE3 CACE @ 0 > IF -1 CACE +! -10 CARDS +! 2! THEN ;          : ACE4 CARD @ 1 = IF 1 CACE +! 10 CARDS +! 1$ THEN ;                                                                            : ACEC1 CARDS @ 21 > IF ACE3 ELSE ACE4 THEN 0 CARD ! ;          : ACEC ACEC1 ACEC1 ;                                                                           ( do the same for the computer ) ( BLACKJACK )                         ( compare the two hands ) : COMP4 CARDS @ HAND @ = IF QUSH ELSE WIN THEN ;                                      ( if both equal, push. Else player wins )                                                                 : COMP3 CARDS @ HAND @ > IF LOSE ELSE COMP4 THEN ;                               ( if computer's hand is greater, player loses)                                                                 : COMP2 CARDS @ 21 > IF WIN ELSE COMP3 THEN ;                                                 ( if computer busts, human wins )                                                                 : COMP1 CARDS @ 21 > IF DRAW ELSE LOSE THEN ;                                   ( if both human & computer busts, it's a draw )                                                                 : COMP HAND @ 21 > IF COMP1 ELSE COMP2 THEN ;                               ( decide if we need to check computer for busting )                                                                 ( BLACKJACK )                             ( play action words ) : HIT CR DEAL DUP ." Card drawn " . HAND +! ACEH ." Total=" HAND       @ . CR ;                   ( deal a card to the player )                                                                 : SHOW CR ." Dealer has " DEAL DUP . CARDS +! ACEC ." Total="          CARDS @ . CR ;           ( deal a card to the computer )                                                                 : STAND SHOW CARDS @ 16 < IF BEGIN DEAL DUP ." Dealer draws "       . CARDS +! ACEC ." Total=" CARDS @ DUP . CR 16 > UNTIL          THEN 1 TESTV ! ;                                                   ( deal cards to computer until 17 or higher is reached )                                                                 : STOP 2 TESTV ! ;                     ( halt by setting flag )                                                                                                                                                                                                 ( BLACKJACK )                              ( player interface ) : LINE ." ? " TIB 80 EXPECT TIB SPAN @ EVALUATE CR ;                               ( interpret a line command from the player )                                                                 : GETB BEGIN CR ." What is your bet ($10 min)" LINE DUP BET       ! 9 > UNTIL ;                                                                                     ( get the amount of a bet )                                                                 : SETUP 0 TESTV ! 0 CACE ! 0 HACE ! HELLO DEAL DUP CARDS !         ." Dealer showing " . ACEC DEAL DUP HAND ! CR ." First card "   . ACEH DEAL DUP HAND +! ." Top card " . ACEH ." Total= "         HAND @ . CR ;                                                                    ( deal out starting cards and show stats )                                                                                                                                                                                                 ( BLACKJACK )                              ( player interface ) : PLAY1 SETUP BEGIN ." Hit, Stand or Stop" LINE TESTV @ 0 >          UNTIL ;                                                                                      ( perform play for one hand )                                                                 : PLAY PAGE HELLO GETB PAGE BEGIN CR CR PLAY1 TESTV @ 2 < IF        COMP THEN TOTAL @ ." Total of bets  " . CR TESTV @ 2 =          UNTIL ;                                                                                 ( perform play until told to quit )                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( BLACKJACK )              ( say hello with basic intrustions )                                                                 : HI  PAGE ." Blackjack Vers. 1.0 is now loaded ." CR             ." Program by Mary Bell 09/12/83" CR                            ." Dealer pays 1 & 1/2 bet for greater hand and takes pushes."  CR ." Dealer must hit on 16 and stand on 17." CR                ." Aces are automatically converted to greatest advantage." CR  ." Type 'PLAY' to start." CR                                    ." Type 'FORGET BLACKJACK' when done with the program." CR CR   ;                                                                                                                             CR .( TYPE 'HI' TO PLAY )                                                                                                                                                                                                                                                                                                       ( deliberate blank.... file end )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ) 